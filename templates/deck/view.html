{% extends '_base.html' %}

{% load i18n static %}

{% block meta_tags %}

{% endblock %}

{% block title %}
    {% trans 'Cartões - ' %} {{ deck.name }}
{% endblock %}

{% block content %}
    <div class="p-10 min-h-full">
        <h1 class="text-3xl font-bold">{{ deck.name }}</h1>
        <div class="grid grid-cols-4 min-h-max">
            <div class="pt-12 pl-5">
                <ul class="text-lg font-semibold text-gray-700 space-y-4">
                    <li class="cursor-pointer hover:bg-gray-300 p-2 px-4 max-w-max">
                        <i class="bi bi-card-text pr-4"></i>{% trans 'Cartões' %}
                    </li>
                    <li class="cursor-pointer hover:bg-gray-300 p-2 px-4 max-w-max">
                        <i class="bi bi-question-octagon-fill pr-4"></i>{% trans 'Questões' %}
                    </li>
                    <li class="cursor-pointer hover:bg-gray-300 p-2 px-4 max-w-max">
                        <i class="bi bi-pencil-fill pr-4"></i>{% trans 'Escrever' %}
                    </li>
                    <li class="cursor-pointer hover:bg-gray-300 p-2 px-4 max-w-max">
                        <i class="bi bi-info-circle-fill pr-4"></i>{% trans 'Informações' %}
                    </li>
                    {% if request.user == deck.creator %}
                        <li class="cursor-pointer hover:bg-gray-300 p-2 px-4 max-w-max"
                            data-modal-toggle="create-flashcard">
                            <i class="bi bi-plus-lg pr-4"></i>{% trans 'Adicionar' %}
                        </li>
                    {% endif %}
                </ul>
            </div>
            <div id="content" class="col-span-3">
            </div>
        </div>
    </div>
    {% include 'includes/modal/delete_flashcard.html' %}
    {% include 'includes/modal/create_card.html' %}
{% endblock %}

{% block javascript %}
    <script>
        htmx.ajax('GET', '{% url "card:view" 1 deck.id %}', '#content')

        function changeCard() {
            let current_card = document.querySelector('#current-card').value

            htmx.ajax('GET', `/card/change/${current_card}/{{ deck.id }}`, '#flashcard')
        }

        function turnCard() {
            let current_card = document.querySelector('#current-card').value
            let current_side = document.querySelector('#current-side').value

            htmx.ajax('GET', `/card/turn/${current_card}/{{ deck.id }}?side=${current_side}`, '#flashcard')
        }

        function deleteCard() {
            close()

            let current_card = document.querySelector('#current-card').value

            htmx.ajax('GET', `/card/remove/${current_card}/{{ deck.id }}`, '#content')
        }

        function editCard() {
            let current_card = document.querySelector('#current-card').value
            let edit_element = document.querySelector('#edit-card')

            if (current_card === '0') return

            if (edit_element.classList.contains('edit')) {
                htmx.ajax('GET', `/card/edit/${current_card}/{{ deck.id }}`, '#flashcard')
                edit_element.innerHTML = '<i class="bi bi-x-lg pr-2"></i> {% trans "Fechar" %}'
            }
            if (edit_element.classList.contains('close')) {
                htmx.ajax('GET', `/card/change/${current_card}/{{ deck.id }}`, '#flashcard')
                edit_element.innerHTML = '<i class="bi bi-pencil-fill pr-2"></i> {% trans "Editar" %}'
            }
        }

        const delete_element = document.getElementById('delete-flashcard');
        const delete_modal = new Modal(delete_element);

        function open() {
            delete_modal.show()
        }

        function close() {
            delete_modal.hide()

            let backdrop = document.querySelector('[modal-backdrop]')
            if (backdrop != null) backdrop.remove()
        }
    </script>
{% endblock %}